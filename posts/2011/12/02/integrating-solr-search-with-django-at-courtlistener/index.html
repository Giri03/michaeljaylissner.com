<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Mike Lissner" />
        <meta name="copyright" content="Mike Lissner" />

        <link rel="author" href=https://plus.google.com/+MikeLissner />
        <meta name="twitter:creator" content="@mlissner">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Sunburnt, Solr, Haystack, django, CourtListener, Tech, " />

<meta property="og:title" content="Integrating Solr Search with Django at CourtListener "/>
<meta property="og:url" content="//localhost:8000/posts/2011/12/02/integrating-solr-search-with-django-at-courtlistener/" />
<meta property="og:description" content="Over the past few weeks, I’ve been hard at work on the new version of CourtListener. Unfortunately, progress has been slower than I’d like due to the limitations of the Solr frameworks I’ve been using. There are a number of competing frameworks available, each with its own ..." />
<meta property="og:site_name" content="Michael Jay Lissner" />
<meta property="og:article:author" content="Mike Lissner" />
<meta property="og:article:published_time" content="2011-12-02T09:37:39" />
<meta name="twitter:title" content="Integrating Solr Search with Django at CourtListener ">
<meta name="twitter:description" content="Over the past few weeks, I’ve been hard at work on the new version of CourtListener. Unfortunately, progress has been slower than I’d like due to the limitations of the Solr frameworks I’ve been using. There are a number of competing frameworks available, each with its own ...">
<meta property="og:image" content="//localhost:8000/theme/images/apple-touch-icon-152x152.png" />
<meta name="twitter:image" content="//localhost:8000/theme/images/apple-touch-icon-152x152.png" >

        <title>Integrating Solr Search with Django at CourtListener  · Michael Jay Lissner
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="//localhost:8000/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="//localhost:8000/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="//localhost:8000/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="//localhost:8000/theme/css/custom.css" media="screen">
        <link rel="shortcut icon" href="//localhost:8000/theme/images/favicon.ico" type="image/x-icon" type="image/png" />
        <link rel="icon" href="//localhost:8000/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="//localhost:8000/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="//localhost:8000/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="//localhost:8000/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="//localhost:8000/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="//localhost:8000/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="//localhost:8000/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="//localhost:8000/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="//localhost:8000/theme/images/apple-touch-icon-152x152.png" type="image/png" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <div class="span1"></div>
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="//localhost:8000/"><span class=site-name>Michael Jay Lissner</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="//localhost:8000">Home</a></li>
                                        <li ><a href="//localhost:8000/about">About&nbsp;Site</a></li>
                                        <li ><a href="//localhost:8000/contact">Contact</a></li>
                                        <li ><a href="//localhost:8000/projects-and-papers">Projects <span class="amp">&amp;</span>&nbsp;Papers</a></li>
                            <li ><a href="//localhost:8000/tags.html">Tags</a></li>
                            <li ><a href="//localhost:8000/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="//localhost:8000/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="//localhost:8000/posts/2011/12/02/integrating-solr-search-with-django-at-courtlistener/"> Integrating Solr Search with Django at&nbsp;CourtListener  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#courtlisteners-needs">CourtListener’s needs</a></li>
<li><a href="#lets-try-haystack">Let’s try Haystack</a></li>
<li><a href="#enter-sunburnt">Enter Sunburnt</a></li>
<li><a href="#what-now">What now?</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">

            
            
<p>Over the past few weeks, I’ve been hard at work on the new version of <a href="http://courtlistener.com">CourtListener</a>. Unfortunately, progress has been slower than I’d like due to the limitations of the Solr frameworks I’ve been using. There are a number of competing frameworks available, each with its own strengths and pitfalls.</p>
<p>So far, I’ve tried two of the popular ones, <a href="http://haystacksearch.org/">Haystack</a> and <a href="http://opensource.timetric.com/sunburnt/index.html">Sunburnt</a>. I’m pretty impressed by both, but today’s blog post is to outline the problems I’m having with these frameworks so that others that are faced with choosing one might be better informed. The difference between these frameworks is vast. Haystack aims to solve all of your integration needs, while Sunburnt is a fairly lightweight wrapper around Solr.</p>
<h2 id="courtlisteners-needs">CourtListener’s needs</h2>
<p>At CourtListener, we have some big goals for the new search version. At its
core, it’s essentially a search-powered site, so we have some big needs:</p>
<ul>
<li><a href="http://www.uxmatters.com/mt/archives/2009/09/best-practices-for-designing-faceted-search-filters.php">Parallel Faceted Search</a></li>
<li>Highlighting</li>
<li>Complex boolean searches supported by Solr’s eDisMax syntax</li>
<li>Snippets below search results and in emails</li>
<li>Standard search stuff: field-level boosting, result and facet counts, field-level searching, result pagination, performance, etc.</li>
</ul>
<p>We’re currently using <a href="http://sphinxsearch.com">Sphinx Search</a> with <a href="http://github.com/dcramer/django-sphinx">django-sphinx</a>, which does a fine job, but it has some problems:</p>
<ul>
<li>django-sphinx hasn’t been maintained in years, and requires patching</li>
<li>django-sphinx doesn’t support snippets</li>
<li>Sphinx doesn’t (yet) support real time indexing (though it’s in beta, I believe)</li>
<li>Sphinx doesn’t have the community and features that Solr does</li>
<li>Unfamiliar syntax for users</li>
</ul>
<p>In general, these problems aren’t too difficult, but in combination, they make for a poor user experience. The last point is a real deal breaker, since most users are accustomed to making queries like [ site:google.com ], which works for Solr and Google, but not for Sphinx. In Sphinx, your query is [ @site(google.com) ]. While we could do post processing of the user’s query to convert it to Google/Solr-style syntax, it’s unreliable and prone to failing in corner cases. Parsing queries is hard. More on this in a moment. </p>
<h2 id="lets-try-haystack">Let’s try Haystack</h2>
<p>In switching from Sphinx, I first tried Haystack as a solution, since it has excellent documentation and seems to be the most popular solution. I spent about two weeks learning about it and getting it in place, but ultimately, I gave up on it because I found that I was subclassing it everywhere. Haystack is a good solution, to be sure, but I found that I was:</p>
<ul>
<li>Subclassing the FacetView so it could support parallel facet counts</li>
<li>Subclassing the FacetForm for another feature I needed</li>
<li>Subclassing the Solr backend so it could support Solr’s highlighting syntax</li>
<li>Further subclassing the Solr backend so it can support additional Solr parameters that aren’t built in</li>
<li>…etc…</li>
</ul>
<p>I worked on that third point for the better part of a day before deciding that Haystack wasn’t for me. Rather than spending my time working on the search needs of CourtListener, I was spending most of it hacking on Haystack, and trying to understand the way it fits together. It’s not unreasonably complex, but there is a <span class="caps">LOT</span> of documentation, and a lot of complexity that I don’t need (such as the ability to switch search backends). Instead of a big solution that allows me to subclass whatever I need (which is good), I needed a lighter-weight solution that was more nimble, and which allowed me to interact with Solr in a more direct way.</p>
<h2 id="enter-sunburnt">Enter Sunburnt</h2>
<p>Sunburnt is a lightweight solution that is everything that Haystack isn’t. From the moment it’s installed, you can start making queries without configuring Django to use it, and without really knowing much else. Its documentation is a single page, which is actually a big relief after coming from Haystack. But Sunburnt has a major problem in its design: It doesn’t support just sending queries to Solr. The expectation in Sunburnt is that each system using it does post-processing on the user’s query, and then submits the query to Sunburnt in stages. </p>
<p>So, if a user searches for “foo bar”, rather than just passing that to Sunburnt, you have to split on the white space, then pass: </p>
<div class="highlight"><pre><span class="n">si</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'foo'</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'bar'</span><span class="p">)</span>
</pre></div>
<p>At first you think, “<span class="caps">OK</span>, I can do that - just split on white space, no big deal.” Then you start thinking about the <a href="http://lucene.apache.org/java/3_4_0/queryparsersyntax.html#Escaping%20Special%20Characters">other syntax</a> that Solr supports, and you realize that you have a real problem if you have to split up queries appropriately. Trust me when I say that you don’t want to be thinking about how to send a query like this one to Sunburnt: [ foo bar “jakarta apache”~10 ]. </p>
<p>The author of Sunburnt will point out that there’s a workaround for this problem. You can use </p>
<div class="highlight"><pre><span class="n">si</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">'"jakarta apache"~10'</span><span class="p">)</span>
</pre></div>
<p>That works, to a point, but that syntax isn’t supported on facets, so your facet counts won’t have the same counts as your results. And so, Sunburnt, though powerful and lightweight, fails.</p>
<h2 id="what-now">What now?</h2>
<p>Good question.</p>
            
            
            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">« <a href="//localhost:8000/posts/2011/10/27/tripling-down/" title="Previous: Tripling Down">Tripling Down</a></li>
                <li class="next-article"><a href="//localhost:8000/posts/2012/01/12/android-icons-from-ice-cream-sandwich/" title="Next: Android Icons from Ice Cream Sandwich">Android Icons from Ice Cream Sandwich</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2011-12-02T09:37:39">Dec 2, 2011</time>
            <h4>Category</h4>
            <a class="category-link" href="//localhost:8000/categories.html#tech-ref">Tech</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="//localhost:8000/tags.html#courtlistener-ref">CourtListener
                    <span>13</span>
</a></li>
                <li><a href="//localhost:8000/tags.html#django-ref">django
                    <span>2</span>
</a></li>
                <li><a href="//localhost:8000/tags.html#haystack-ref">Haystack
                    <span>1</span>
</a></li>
                <li><a href="//localhost:8000/tags.html#solr-ref">Solr
                    <span>1</span>
</a></li>
                <li><a href="//localhost:8000/tags.html#sunburnt-ref">Sunburnt
                    <span>1</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="http://twitter.com/mlissner" title="My Twitter Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-twitter sidebar-social-links"></i></a>
    <a href="http://github.com/mlissner" title="My Github Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-github sidebar-social-links"></i></a>
    <a href="mailto:mlissner+blog@michaeljaylissner.com" title="My Email Address" class="sidebar-social-links" target="_blank">
    <i class="fa fa-envelope sidebar-social-links"></i></a>
<h4>This is Reader-Editable</h4>
<a href="https://github.com/mlissner/michaeljaylissner.com/edit/master/content/integrating-solr-search-with-django-at-courtlistener.md">
    <i class="fa fa-github"></i>
    Edit this post on Github
</a><!-- Begin MailChimp Signup Form -->
<div id="mc-embed-signup">
<form action="//asdf.us2.list-manage.com/subscribe/post?u=87204b44efb46f0fd27b95167&amp;id=f511375e11" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
<h4>Get Weekly Updates</h4>
<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Enter your email..." required>
<div class="clear"><input type="submit" value="Send Me Updates" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
</form>
</div>
<!--End mc_embed_signup-->
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license">Unless mentioned otherwise, all material on this site is <a href="about#license">licensed</a> under a Creative Commons copyright or the GNU Affero GPL. <a href="about#privacy">Privacy Policy</a>.</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>