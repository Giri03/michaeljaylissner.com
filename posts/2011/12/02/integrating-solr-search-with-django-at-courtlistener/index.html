<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Michael Lissner" />
        <meta name="copyright" content="Michael Lissner" />

<meta name="keywords" content="Sunburnt, Solr, Haystack, django, courtlistener.com, Tech, " />
        <title>Integrating Solr Search with Django at&nbsp;CourtListener - Michael Jay Lissner
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://michaeljaylissner.com/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://michaeljaylissner.com/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="http://michaeljaylissner.com/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://michaeljaylissner.com/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://michaeljaylissner.com/theme/images/apple-touch-icon-144x144.png" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://michaeljaylissner.com/"><span class=site-name>Michael Jay Lissner</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://michaeljaylissner.com">Home</a></li>
                            <li ><a href="http://michaeljaylissner.com/pages/about.html">About this&nbsp;Site</a></li>
                            <li ><a href="http://michaeljaylissner.com/categories.html">Categories</a></li>
                            <li ><a href="http://michaeljaylissner.com/tags.html">Tags</a></li>
                            <li ><a href="http://michaeljaylissner.com/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://michaeljaylissner.com/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://michaeljaylissner.com/posts/2011/12/02/integrating-solr-search-with-django-at-courtlistener/"> Integrating Solr Search with Django at&nbsp;CourtListener  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <p>Over the past few weeks, I&#8217;ve been hard at work on the new version of <a href="http://courtlistener.com">CourtListener</a>. Unfortunately, progress has been slower than I&#8217;d like due to the limitations of the Solr frameworks I&#8217;ve been using. There are a number of competing frameworks available, each with its own strengths and&nbsp;pitfalls.</p>
<p>So far, I&#8217;ve tried two of the popular ones, <a href="http://haystacksearch.org/">Haystack</a> and <a href="http://opensource.timetric.com/sunburnt/index.html">Sunburnt</a>. I&#8217;m pretty impressed by both, but today&#8217;s blog post is to outline the problems I&#8217;m having with these frameworks so that others that are faced with choosing one might be better informed. The difference between these frameworks is vast. Haystack aims to solve all of your integration needs, while Sunburnt is a fairly lightweight wrapper around&nbsp;Solr.</p>
<h3>CourtListener&#8217;s&nbsp;needs</h3>

<p>At CourtListener, we have some big goals for the new search version. At its core, it&#8217;s essentially a search-powered site, so we have some big&nbsp;needs:</p>

<ul>
<li><a href="http://www.uxmatters.com/mt/archives/2009/09/best-practices-for-designing-faceted-search-filters.php">Parallel Faceted&nbsp;Search</a></li>
<li>Highlighting</li>
<li>Complex boolean searches supported by Solr&#8217;s eDisMax&nbsp;syntax</li>
<li>Snippets below search results and in&nbsp;emails</li>
<li>Standard search stuff: field-level boosting, result and facet counts, field-level searching, result pagination, performance,&nbsp;etc.</li>
</ul>
<p>We&#8217;re currently using <a href="http://sphinxsearch.com">Sphinx Search</a> with <a href="http://github.com/dcramer/django-sphinx">django-sphinx</a>, which does a fine job, but it has some&nbsp;problems:</p>
<ul>
<li>django-sphinx hasn&#8217;t been maintained in years, and requires&nbsp;patching</li>
<li>django-sphinx doesn&#8217;t support&nbsp;snippets</li>
<li>Sphinx doesn&#8217;t (yet) support real time indexing (though it&#8217;s in beta, I&nbsp;believe)</li>
<li>Sphinx doesn&#8217;t have the community and features that Solr&nbsp;does</li>
<li>Unfamiliar syntax for&nbsp;users</li>
</ul>
<p>In general, these problems aren&#8217;t too difficult, but in combination, they make for a poor user experience. The last point is a real deal breaker, since most users are accustomed to making queries like [ site:google.com ], which works for Solr and Google, but not for Sphinx. In Sphinx, your query is [ @site(google.com) ]. While we could do post processing of the user&#8217;s query to convert it to Google/Solr-style syntax, it&#8217;s unreliable and prone to failing in corner cases. Parsing queries is hard. More on this in a&nbsp;moment. </p>
<h3>Let&#8217;s try&nbsp;Haystack</h3>

<p>In switching from Sphinx, I first tried Haystack as a solution, since it has excellent documentation and seems to be the most popular solution. I spent about two weeks learning about it and getting it in place, but ultimately, I gave up on it because I found that I was subclassing it everywhere. Haystack is a good solution, to be sure, but I found that I&nbsp;was:</p>
<ul>
<li>Subclassing the FacetView so it could support parallel facet&nbsp;counts</li>
<li>Subclassing the FacetForm for another feature I&nbsp;needed</li>
<li>Subclassing the Solr backend so it could support Solr&#8217;s highlighting&nbsp;syntax</li>
<li>Further subclassing the Solr backend so it can support additional Solr parameters that aren&#8217;t built&nbsp;in</li>
<li>&#8230;etc&#8230;</li>
</ul>
<p>I worked on that third point for the better part of a day before deciding that Haystack wasn&#8217;t for me. Rather than spending my time working on the search needs of CourtListener, I was spending most of it hacking on Haystack, and trying to understand the way it fits together. It&#8217;s not unreasonably complex, but there is a <span class="caps">LOT</span> of documentation, and a lot of complexity that I don&#8217;t need (such as the ability to switch search backends). Instead of a big solution that allows me to subclass whatever I need (which is good), I needed a lighter-weight solution that was more nimble, and which allowed me to interact with Solr in a more direct&nbsp;way.</p>
<h3>Enter&nbsp;Sunburnt</h3>

<p>Sunburnt is a lightweight solution that is everything that Haystack isn&#8217;t. From the moment it&#8217;s installed, you can start making queries without configuring Django to use it, and without really knowing much else. Its documentation is a single page, which is actually a big relief after coming from Haystack. But Sunburnt has a major problem in its design: It doesn&#8217;t support just sending queries to Solr. The expectation in Sunburnt is that each system using it does post-processing on the user&#8217;s query, and then submits the query to Sunburnt in&nbsp;stages. </p>
<p>So, if a user searches for &#8220;foo bar&#8221;, rather than just passing that to Sunburnt, you have to split on the white space, then&nbsp;pass: </p>
<div class="highlight"><pre><span class="n">si</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>


<p>At first you think, &#8220;<span class="caps">OK</span>, I can do that - just split on white space, no big deal.&#8221; Then you start thinking about the <a href="http://lucene.apache.org/java/3_4_0/queryparsersyntax.html#Escaping%20Special%20Characters">other syntax</a> that Solr supports, and you realize that you have a real problem if you have to split up queries appropriately. Trust me when I say that you don&#8217;t want to be thinking about how to send a query like this one to Sunburnt: [ foo bar &#8220;jakarta apache&#8221;~10&nbsp;]. </p>
<p>The author of Sunburnt will point out that there&#8217;s a workaround for this problem. You can&nbsp;use </p>
<div class="highlight"><pre><span class="n">si</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">&#39;&quot;jakarta apache&quot;~10&#39;</span><span class="p">)</span>
</pre></div>


<p>That works, to a point, but that syntax isn&#8217;t supported on facets, so your facet counts won&#8217;t have the same counts as your results. And so, Sunburnt, though powerful and lightweight,&nbsp;fails.</p>
<h3>What&nbsp;now?</h3>

<p>Good&nbsp;question.</p>
            <aside>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="http://michaeljaylissner.com/posts/2011/10/27/tripling-down/" title="Previous: Tripling&nbsp;Down">Tripling&nbsp;Down</a></li>
 
                <li class="next_article"><a href="http://michaeljaylissner.com/posts/2012/01/12/android-icons-from-ice-cream-sandwich/" title="Next: Android Icons from Ice Cream&nbsp;Sandwich">Android Icons from Ice Cream&nbsp;Sandwich</a> »</li>
            </ul>
            </nav>
            </aside>
<section>
<hr/>
<p id="comment-message">I love getting feedback and comments. Make my day by making a comment. </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2" 
                href="http://michaeljaylissner.com/posts/2011/12/02/integrating-solr-search-with-django-at-courtlistener//#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'michaeljaylissner';
        var disqus_identifier = 'http://michaeljaylissner.com/posts/2011/12/02/integrating-solr-search-with-django-at-courtlistener/';
    var disqus_url = 'http://michaeljaylissner.com/posts/2011/12/02/integrating-solr-search-with-django-at-courtlistener/';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2011-12-02T09:37:39">Dec 2, 2011</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#Tech-ref">Tech</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#courtlistener.com-ref">courtlistener.com
                    <span>12</span>
</a></li>
                <li><a href="/tags.html#django-ref">django
                    <span>2</span>
</a></li>
                <li><a href="/tags.html#Haystack-ref">Haystack
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#Solr-ref">Solr
                    <span>1</span>
</a></li>
                <li><a href="/tags.html#Sunburnt-ref">Sunburnt
                    <span>1</span>
</a></li>
            </ul>

        </div>
        </section>
    </div>
    </article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license">Unless mentioned otherwise, all material on this site is <a href="about#license">licensed</a> under a Creative Commons copyright or the GNU Affero GPL. <a href="about#privacy">Privacy Policy</a>.</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'michaeljaylissner';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    </body>
</html>