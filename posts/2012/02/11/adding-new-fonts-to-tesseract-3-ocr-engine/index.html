<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Michael Lissner" />
        <meta name="copyright" content="Michael Lissner" />

<meta name="keywords" content="tesseract, ocr, howto, font, Tech, " />
        <title>Adding New Fonts to Tesseract 3 <span class="caps">OCR</span>&nbsp;Engine - Michael Jay Lissner
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../../../../../theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="../../../../../theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="../../../../../theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="../../../../../theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="../../../../../theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="../../../../../theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="../../../../../theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="../../../../../theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="../../../../../theme/images/apple-touch-icon-144x144.png" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="../../../../../"><span class=site-name>Michael Jay Lissner</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="../../../../..">Home</a></li>
                            <li ><a href="../../../../../pages/about.html">About this&nbsp;Site</a></li>
                            <li ><a href="../../../../../categories.html">Categories</a></li>
                            <li ><a href="../../../../../tags.html">Tags</a></li>
                            <li ><a href="../../../../../archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="../../../../../search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="../../../../../posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/"> Adding New Fonts to Tesseract 3 <span class="caps">OCR</span>&nbsp;Engine  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <p><em>Update:</em> I&#8217;ve turned off commenting on this article because it was just a bunch of people asking for help and never getting any. If you need help with these instructions, go to Stack Overflow and ask there. If you have corrections to the article, please send them directly to me using the Contact&nbsp;form.</p>
<p><a href="http://code.google.com/p/tesseract-ocr/">Tesseract</a> is a great and powerful <span class="caps">OCR</span> engine, but their <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3">instructions for adding a new font</a> are incredibly long and complicated. At CourtListener we have to handle several unusual <a href="http://en.wikipedia.org/wiki/Blackletter">blackletter fonts</a>, so we had to go through this process a few times. Below I&#8217;ve explained the process so others may more easily add fonts to their&nbsp;system.</p>
<p>The process has a few major&nbsp;steps:</p>
<ul>
<li><a href="#create-training-docs">Create training&nbsp;documents</a></li>
<li><a href="#train-tesseract">Teach Tesseract about the&nbsp;documents</a></li>
</ul>
<h3 id="create-training-documents">Create training&nbsp;documents</h3>
<p>To create training documents, open up <span class="caps">MS</span> Word or LibreOffice, paste in the contents of the attached file named &#8216;standard-training-text.txt&#8217;. This file contains the training text that is used by Tesseract for the included&nbsp;fonts.</p>
<p>Set your line spacing to at least 1.5, and space out the letters by about 1pt. using character spacing. I&#8217;ve attached a sample doc too, if that helps. Set the text to the font you want to use, and save it as&nbsp;font-name.doc.</p>
<p>Save the document as a <span class="caps">PDF</span> (call it [lang].font-name.exp0.pdf, with lang being an <a href="http://www.sil.org/iso639-3/iso-639-3_Name_Index_20120203.tab"><span class="caps">ISO</span>-639 three letter abbreviation</a> for your language), and then use the following command to convert it to a 300dpi tiff (requires&nbsp;imagemagick):</p>
<p><code>convert -density 300 -depth 4 lang.font-name.exp0.pdf lang.font-name.exp0.tif</code></p>
<p>You&#8217;ll now have a good training image called lang.font-name.exp0.tif. If you&#8217;re adding multiple fonts, or bold, italic or underline, repeat this process multiple times, creating one doc &rarr; pdf &rarr;  tiff per font&nbsp;variation.</p>
<h3 id="train-tesseract">Train&nbsp;Tesseract</h3>
<p>The next step is to run tesseract over the image(s) we just created, and to see how well it can do with the new font. After it&#8217;s taken its best shot, we then give it corrections. It&#8217;ll provide us with a box file, which is just a file containing x,y coordinates of each letter it found along with what letter it thinks it is. So let&#8217;s see what it can&nbsp;do:</p>
<div class="highlight"><pre><span class="n">tesseract</span> <span class="n">lang</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">exp0</span><span class="p">.</span><span class="n">tiff</span> <span class="n">lang</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">exp0</span> <span class="n">batch</span><span class="p">.</span><span class="n">nochop</span> <span class="n">makebox</span>
</pre></div>


<p>You&#8217;ll now have a file called font-name.exp0.box, and you&#8217;ll need to open it in a box-file editor. There are a bunch of these <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3#Box_File_Editors">on the Tesseract wiki</a>. The one that works for me (on Ubuntu) is <a href="http://code.google.com/p/moshpytt/">moshpytt</a>, though it doesn&#8217;t support multi-page tiffs. If you need to use a multi-page tiff, see <a href="http://code.google.com/p/moshpytt/issues/detail?id=2">the issue on the topic</a> for tips. Once you&#8217;ve opened it, go through <strong>every</strong> letter, and make sure it was detected correctly. If a letter was skipped, add it as a row to the box file. Similarly, if two letters were detected as one, break them up into two&nbsp;lines.</p>
<p>When that&#8217;s done, you feed the box file back into&nbsp;tesseract:</p>
<div class="highlight"><pre><span class="n">tesseract</span> <span class="n">eng</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">exp0</span><span class="p">.</span><span class="n">tif</span> <span class="n">eng</span><span class="p">.</span><span class="n">font</span><span class="o">-</span><span class="n">name</span><span class="p">.</span><span class="n">box</span> <span class="n">nobatch</span> <span class="n">box</span><span class="p">.</span><span class="n">train</span> <span class="p">.</span><span class="n">stderr</span>
</pre></div>


<p>Next, you need to detect the Character set used in all your box&nbsp;files:</p>
<div class="highlight"><pre><span class="n">unicharset_extractor</span> <span class="o">*</span><span class="p">.</span><span class="n">box</span>
</pre></div>


<p>When that&#8217;s complete, you need to create a <code>font_properties</code> file. It should list every font you&#8217;re training, one per line, and identify whether it has the following characteristics: &lt;fontname&gt; &lt;italic&gt; &lt;bold&gt; &lt;fixed&gt; &lt;serif&gt;&nbsp;&lt;fraktur&gt;</p>
<p>So, for example, if you use the standard training data, you might end up with a file like&nbsp;this:</p>
<div class="highlight"><pre>eng.arial.box 0 0 0 0 0
eng.arialbd.box 0 1 0 0 0
eng.arialbi.box 1 1 0 0 0
eng.ariali.box 1 0 0 0 0
eng.b018012l.box 0 0 0 1 0
eng.b018015l.box 0 1 0 1 0
eng.b018032l.box 1 0 0 1 0
eng.b018035l.box 1 1 0 1 0
eng.c059013l.box 0 0 0 1 0
eng.c059016l.box 0 1 0 1 0
eng.c059033l.box 1 0 0 1 0
eng.c059036l.box 1 1 0 1 0
eng.cour.box 0 0 1 1 0
eng.courbd.box 0 1 1 1 0
eng.courbi.box 1 1 1 1 0
eng.couri.box 1 0 1 1 0
eng.georgia.box 0 0 0 1 0
eng.georgiab.box 0 1 0 1 0
eng.georgiai.box 1 0 0 1 0
eng.georgiaz.box 1 1 0 1 0
&lt;strong&gt;eng.lincoln.box 0 0 0 0 1&lt;/strong&gt;
&lt;strong&gt;eng.old-english.box 0 0 0 0 1&lt;/strong&gt;
eng.times.box 0 0 0 1 0
eng.timesbd.box 0 1 0 1 0
eng.timesbi.box 1 1 0 1 0
eng.timesi.box 1 0 0 1 0
eng.trebuc.box 0 0 0 1 0
eng.trebucbd.box 0 1 0 1 0
eng.trebucbi.box 1 1 0 1 0
eng.trebucit.box 1 0 0 1 0
eng.verdana.box 0 0 0 0 0
eng.verdanab.box 0 1 0 0 0
eng.verdanai.box 1 0 0 0 0
eng.verdanaz.box 1 1 0 0 0
</pre></div>


<p>Note that this is the standard font_properties file that should be supplied with Tesseract and I&#8217;ve added the two bold rows for the blackletter fonts I&#8217;m training. You can also see which fonts are included out of the&nbsp;box.</p>
<p>We&#8217;re getting near the end. Next, create the clustering&nbsp;data:</p>
<div class="highlight"><pre>mftraining -F font_properties -U unicharset -O lang.unicharset *.tr 
cntraining *.tr
</pre></div>


<p>If you want, you can <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3#Dictionary_Data_(Optional)">create a wordlist</a> or a <a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3#The_last_file_(unicharambigs)">unicharambigs file</a>. If you don&#8217;t plan on doing that, the last step is to combine the various files we&#8217;ve&nbsp;created. </p>
<p>To do that, rename each of the language files (normproto, Microfeat, inttemp, pffmtable) to have your lang prefix, and run (mind the dot at the&nbsp;end):</p>
<div class="highlight"><pre><span class="n">combine_tessdata</span> <span class="n">lang</span><span class="p">.</span>
</pre></div>


<p>This will create all the data files you need, and you just need to move them to the correct place on your <span class="caps">OS</span>. On Ubuntu, I was able to move them&nbsp;to;</p>
<div class="highlight"><pre><span class="n">sudo</span> <span class="n">mv</span> <span class="n">eng</span><span class="p">.</span><span class="n">traineddata</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">tessdata</span><span class="o">/</span>
</pre></div>


<p>And that, good friend, is it. Worst process for a human,&nbsp;ever.</p>
            <aside>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="../../../../../posts/2012/01/27/and-the-winning-font-in-court-documents-is/" title="Previous: The Winning Font in Court&nbsp;Opinions">The Winning Font in Court&nbsp;Opinions</a></li>
 
                <li class="next_article"><a href="../../../../../posts/2012/03/15/my-presentation-proposal-for-lvi-2012/" title="Next: My Presentation Proposal for <span class="caps">LVI</span>&nbsp;2012">My Presentation Proposal for <span class="caps">LVI</span>&nbsp;2012</a> »</li>
            </ul>
            </nav>
            </aside>
<section>
<hr/>
<p id="comment-message">I love getting feedback and comments. Make my day by making a comment. </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2" 
                href="../../../../../posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine//#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'michaeljaylissner';
        var disqus_identifier = '../../../../../posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/';
    var disqus_url = '../../../../../posts/2012/02/11/adding-new-fonts-to-tesseract-3-ocr-engine/';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2012-02-11T10:53:30">Feb 11, 2012</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#Tech-ref">Tech</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#font-ref">font
                    <span>2</span>
</a></li>
                <li><a href="/tags.html#howto-ref">howto
                    <span>3</span>
</a></li>
                <li><a href="/tags.html#ocr-ref">ocr
                    <span>2</span>
</a></li>
                <li><a href="/tags.html#tesseract-ref">tesseract
                    <span>2</span>
</a></li>
            </ul>

        </div>
        </section>
    </div>
    </article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license">Unless mentioned otherwise, all material on this site is <a href="about#license">licensed</a> under a Creative Commons copyright or the GNU Affero GPL. <a href="about#privacy">Privacy Policy</a>.</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'michaeljaylissner';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    </body>
</html>